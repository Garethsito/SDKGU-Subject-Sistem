generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  relationMode = "prisma"
}

model Program {
  id           Int      @id @default(autoincrement())
  programName  String   @unique
  programType  String
  totalCourses Int
  totalUnits   Int?
  students     Student[]
  sessions     Session[]
  courses      Course[]
}

model Student {
  id                      BigInt   @id  // Cambiado: ahora es BigInt sin autoincrement
  studentIdNumber         String   @unique  // Nuevo: para almacenar el ID original como string
  firstName               String
  lastName                String
  email                   String?  @unique
  sdgkuEmail              String?  @unique
  rgmKey                  String?  @unique
  startDate               DateTime
  admissionDate           DateTime?
  enrollmentYear          Int
  status                  String   @default("active")
  modality                String?
  cohort                  String?
  language                String?
  transferredUnits        Int      @default(0)
  unitQuantity            Int      @default(0)
  totalUnitsEarned        Int      @default(0)
  scheduledCompletionDate DateTime?
  graduationDate          DateTime?
  program                 Program  @relation(fields: [programId], references: [id])
  programId               Int
  enrollments             Enrollment[]
  transfers               Transfer[]
  records                 AcademicRecord[]
  payments                Payment[]
  
  @@unique([firstName, lastName, startDate])
  @@index([programId])
  @@index([lastName])
  @@index([rgmKey])
  @@index([sdgkuEmail])
  @@index([studentIdNumber])
}

model Course {
  id             Int      @id @default(autoincrement())
  courseCode     String   @unique
  courseName     String
  credits        Int      @default(3)
  language       String?
  isTransferable Boolean  @default(true)
  maxCapacity    Int?
  program        Program  @relation(fields: [programId], references: [id])
  programId      Int
  prerequisites      Prerequisite[] @relation("PrerequisitesForCourse")
  prerequisiteFor    Prerequisite[] @relation("PrerequisitesForOther")
  offerings          CourseOffering[]
  records            AcademicRecord[]
  transfers          Transfer[]
  
  @@index([programId])
  @@index([courseCode])
}

model Prerequisite {
  id                   Int     @id @default(autoincrement())
  course               Course  @relation("PrerequisitesForCourse", fields: [courseId], references: [id])
  courseId             Int
  prerequisiteCourse   Course  @relation("PrerequisitesForOther", fields: [prerequisiteCourseId], references: [id])
  prerequisiteCourseId Int
  
  @@unique([courseId, prerequisiteCourseId])
  @@index([courseId])
  @@index([prerequisiteCourseId])
}

model Session {
  id          Int      @id @default(autoincrement())
  sessionName String   @unique
  startDate   DateTime
  endDate     DateTime
  program     Program  @relation(fields: [programId], references: [id])
  programId   Int
  offerings   CourseOffering[]
  records     AcademicRecord[]
  
  @@index([programId])
  @@index([sessionName])
}

model CourseOffering {
  id          Int      @id @default(autoincrement())
  course      Course   @relation(fields: [courseId], references: [id])
  courseId    Int
  session     Session  @relation(fields: [sessionId], references: [id])
  sessionId   Int
  maxStudents Int?
  enrollments Enrollment[]
  
  @@unique([courseId, sessionId])
  @@index([courseId])
  @@index([sessionId])
}

model Enrollment {
  id         Int             @id @default(autoincrement())
  student    Student         @relation(fields: [studentId], references: [id])
  studentId  BigInt
  offering   CourseOffering  @relation(fields: [offeringId], references: [id])
  offeringId Int
  status     String          @default("enrolled")
  grade      String?
  
  @@unique([studentId, offeringId])
  @@index([studentId])
  @@index([offeringId])
}

model Transfer {
  id           Int       @id @default(autoincrement())
  student      Student   @relation(fields: [studentId], references: [id])
  studentId    BigInt
  course       Course    @relation(fields: [courseId], references: [id])
  courseId     Int
  transferType String?
  approvalDate DateTime?
  
  @@index([studentId])
  @@index([courseId])
}

model AcademicRecord {
  id        Int      @id @default(autoincrement())
  student   Student  @relation(fields: [studentId], references: [id])
  studentId BigInt
  course    Course   @relation(fields: [courseId], references: [id])
  courseId  Int
  session   Session? @relation(fields: [sessionId], references: [id])
  sessionId Int?
  status    String?
  grade     String?
  isPayment Boolean  @default(false)
  paymentInfo String?
  
  @@unique([studentId, courseId, sessionId])
  @@index([studentId])
  @@index([courseId])
  @@index([sessionId])
}

model Payment {
  id          Int      @id @default(autoincrement())
  student     Student  @relation(fields: [studentId], references: [id])
  studentId   BigInt
  amount      String
  paymentDate DateTime?
  method      String?
  description String?
  courseCode  String?
  
  @@index([studentId])
}

model Login {
  id        Int     @id @default(autoincrement())
  username  String  @unique
  password  String
}